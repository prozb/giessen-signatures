<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>–ó–±—ñ—Ä –ø—ñ–¥–ø–∏—Å—ñ–≤ ‚Äì –ì—ñ—Å—Å–µ–Ω 2026</title>
  <meta name="description" content="–î–∞—à–±–æ—Ä–¥ –∑–±–æ—Ä—É –ø—ñ–¥–ø–∏—Å—ñ–≤ –¥–ª—è –≤–∏–±–æ—Ä—ñ–≤ –†–∞–¥–∏ —ñ–Ω–æ–∑–µ–º—Ü—ñ–≤ 2026 —É –ì—ñ—Å—Å–µ–Ω—ñ." />

  <style>
    :root{
      --bgTop:#475569;
      --bgBot:#1e293b;

      --card: rgba(255,255,255,.10);
      --stroke: rgba(148,163,184,.45);

      --text: #f8fafc;
      --muted:#e2e8f0;

      --shadow: 0 20px 55px rgba(0,0,0,.30);

      --r-xl: 26px;
      --r-lg: 18px;

      /* progress colors */
      --c-low:  #ef4444; /* red */
      --c-mid:  #f59e0b; /* yellow */
      --c-high: #22c55e; /* green */
    }

    *{box-sizing:border-box;margin:0;padding:0}
    body{
      min-height:100vh;
      font-family: system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      color:var(--text);
      background:
        radial-gradient(circle at 15% 0%, rgba(96,165,250,.35), transparent 60%),
        radial-gradient(circle at 85% 0%, rgba(251,146,60,.35), transparent 60%),
        radial-gradient(circle at 50% 100%, rgba(34,197,94,.25), transparent 65%),
        linear-gradient(180deg, var(--bgTop), var(--bgBot));
      display:flex;
      justify-content:center;
      padding:18px 12px 28px;
    }

    .shell{
      width:100%;
      max-width:920px;
      border:1px solid rgba(148,163,184,.55);
      border-radius:30px;
      box-shadow:var(--shadow);
      background:linear-gradient(145deg, rgba(255,255,255,.08), rgba(255,255,255,.06));
      backdrop-filter: blur(14px);
      overflow:hidden;

      display:flex;
      flex-direction:column;
      min-height:100%;
    }

    header{
      padding:16px 16px 10px;
    }

    .top{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:12px;
      flex-wrap:wrap;
    }

    .content-footer{
      margin-top: 18px;
      padding: 14px 10px 10px;
      text-align: center;
      font-size: 0.8rem;
      color: var(--muted);
      opacity: 0.7;
    }

    .brand{
      display:flex;
      gap:12px;
      align-items:flex-start;
      min-width:0;
      flex: 1 1 320px;
    }

    .logo{
      width:44px;height:44px;
      border-radius:14px;
      border:1px solid rgba(148,163,184,.55);
      background:rgba(255,255,255,.12);
      display:grid;
      place-items:center;
      flex: 0 0 auto;
    }

    h1{
      font-size:1.2rem;
      line-height:1.2;
      letter-spacing:.01em;
      margin-top:2px;
      white-space:normal;
      overflow:visible;
      text-overflow:clip;
      word-break:break-word;
    }

    .desc{
      margin-top:6px;
      color:var(--muted);
      font-size:.92rem;
      line-height:1.5;
      max-width:640px;
      word-break:break-word;
    }

    .lang{
      display:flex;
      align-items:center;
      gap:8px;
      background:rgba(255,255,255,.10);
      border:1px solid rgba(148,163,184,.45);
      border-radius:999px;
      padding:6px;
      flex: 0 0 auto;
    }
    .lang button{
      border:0;
      background:transparent;
      color:var(--text);
      font-size:.88rem;
      padding:6px 10px;
      border-radius:999px;
      cursor:pointer;
      display:flex;
      align-items:center;
      gap:8px;
      opacity:.88;
      transition:.15s ease;
      user-select:none;
    }
    .lang button[aria-pressed="true"]{
      background:rgba(255,255,255,.14);
      opacity:1;
    }

    .flag{
      width:18px;height:12px;border-radius:3px;
      box-shadow:0 0 0 1px rgba(255,255,255,.18) inset;
      flex:0 0 auto;
    }

    .chips{
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      padding:10px 16px 6px;
    }

    .chip{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:7px 10px;
      border-radius:999px;
      border:1px solid rgba(148,163,184,.45);
      background:rgba(255,255,255,.10);
      color:var(--muted);
      font-size:.84rem;
      white-space:nowrap;
    }
    .dot{
      width:8px;height:8px;border-radius:50%;
      background:#22c55e;
      box-shadow:0 0 0 5px rgba(34,197,94,.16);
    }
    .chip strong{color:var(--text); font-weight:700;}

    main{
      flex:1;
      padding:12px 16px 18px;
    }

    .card{
      border-radius: var(--r-xl);
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.12);
      box-shadow: 0 14px 40px rgba(0,0,0,.18);
      padding:16px;
      overflow:hidden;
      position:relative;
    }
    .card::after{
      content:"";
      position:absolute; inset:0;
      background: linear-gradient(to bottom right, rgba(255,255,255,.10), transparent 55%);
      opacity:.8;
      pointer-events:none;
    }

    .card h2{
      position:relative; z-index:1;
      font-size:1.02rem;
      letter-spacing:.01em;
    }
    .sub{
      position:relative; z-index:1;
      margin-top:4px;
      color:var(--muted);
      font-size:.88rem;
      line-height:1.45;
    }

    .list{
      position:relative; z-index:1;
      display:flex;
      flex-direction:column;
      gap:12px;
      margin-top:14px;
    }

    .item{
      border-radius: var(--r-lg);
      border:1px solid rgba(148,163,184,.45);
      background: rgba(255,255,255,.10);
      padding:12px;
      position:relative;
      overflow:hidden;
    }

    .itemHead{
      display:flex;
      align-items:baseline;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
    }
    .name{
      font-weight:800;
      letter-spacing:.01em;
    }
    .pct{
      font-weight:900;
      font-size:.95rem;
      opacity:.95;
    }

    /* PROGRESS */
    .progressWrap{
      margin-top:10px;
      position:relative;
      padding-bottom:14px; /* Platz f√ºr Marker unter der Bar */
    }

    .track{
      height:18px;
      border-radius:999px;
      border:1px solid rgba(148,163,184,.40);
      background: rgba(15,23,42,.22);
      overflow:hidden;
    }

    .fill{
      height:100%;
      width:0%;
      border-radius:999px;
      transition: width .9s ease-out; /* etwas smoother */
      position:relative;
      will-change: width;
    }
    .fill::after{
      content:"";
      position:absolute; inset:0;
      background-image: linear-gradient(120deg, rgba(255,255,255,.45) 0, rgba(255,255,255,.08) 40%, transparent 65%);
      opacity:.65;
      mix-blend-mode: soft-light;
    }

    /* ‚úÖ Marker unter der Bar, zeigt nach oben */
    .minMarker{
      position:absolute;
      top: 26px;
      width:0;height:0;
      border-left:7px solid transparent;
      border-right:7px solid transparent;
      border-bottom:9px solid rgba(255,255,255,.92); /* ‚ñ≤ Dreieck zeigt nach oben */
      filter: drop-shadow(0 4px 6px rgba(0,0,0,.25));
      transform: translateX(-50%);
    }
  

    .badgeRow{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin-top:10px;
    }

    .row{
      margin-top:10px;
      display:flex;
      align-items:baseline;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
      color:var(--muted);
      font-size:.86rem;
    }
    .row strong{color:var(--text); font-weight:800}

    .pill{
      display:inline-flex;
      align-items:center;
      gap:6px;
      padding:4px 10px;
      border-radius:999px;
      border:1px solid rgba(148,163,184,.45);
      background: rgba(255,255,255,.10);
      color:var(--muted);
      font-size:.82rem;
      white-space:nowrap;
    }
    .pill b{color:var(--text); font-weight:900}

    .pill.deltaPlus b{ color: var(--c-high); }
    .pill.deltaMinus b{ color: var(--c-low); }

    .leader{
      margin-top:14px;
      padding:12px 12px;
      border-radius: var(--r-lg);
      border:1px dashed rgba(148,163,184,.60);
      background: rgba(255,255,255,.10);
      color:var(--muted);
      font-size:.9rem;
      line-height:1.45;
      position:relative; z-index:1;
    }
    .leader b{color:var(--text)}

    #fxWrap{
      position:fixed;
      inset:0;
      pointer-events:none;
      opacity:0;
      transition: opacity .25s ease;
      z-index:9999;
    }
    #fxWrap.show{opacity:1}
    #fx{
      width:100%;
      height:100%;
      display:block;
    }
    .toast{
      position:fixed;
      left:50%;
      transform:translateX(-50%);
      bottom:18px;
      max-width:min(560px, calc(100% - 22px));
      padding:12px 14px;
      border-radius:16px;
      border:1px solid rgba(148,163,184,.55);
      background: rgba(15,23,42,.55);
      backdrop-filter: blur(12px);
      box-shadow: 0 18px 45px rgba(0,0,0,.35);
      opacity:0;
      transition: opacity .25s ease, transform .25s ease;
      z-index:10000;
    }
    .toast.show{
      opacity:1;
      transform:translateX(-50%) translateY(-4px);
    }
    .toast h3{font-size:1rem;margin-bottom:2px}
    .toast p{color:var(--muted);font-size:.9rem;line-height:1.35}

    @media (max-width:520px){
      header{padding:14px 14px 10px}
      main{padding:10px 14px 16px}
      .chips{padding:10px 14px 4px}
      h1{font-size:1.15rem}
      .desc{font-size:.95rem}
    }
  </style>
</head>

<body>
  <div id="fxWrap"><canvas id="fx"></canvas></div>

  <div class="shell">
    <header>
      <div class="top">
        <div class="brand">
          <div class="logo" aria-hidden="true">üìã</div>
          <div>
            <h1 id="t_title">–ó–±—ñ—Ä –ø—ñ–¥–ø–∏—Å—ñ–≤</h1>
            <div class="desc" id="t_desc">
              –ú–∏ –∑–±–∏—Ä–∞—î–º–æ –ø—ñ–¥—Ç—Ä–∏–º—É–≤–∞–ª—å–Ω—ñ –ø—ñ–¥–ø–∏—Å–∏, —â–æ–± –±–∞–ª–æ—Ç—É–≤–∞—Ç–∏—Å—è –Ω–∞ –≤–∏–±–æ—Ä–∞—Ö –†–∞–¥–∏ —ñ–Ω–æ–∑–µ–º—Ü—ñ–≤ 2026 —Ä–æ–∫—É –≤ –ì—ñ—Å—Å–µ–Ω—ñ.
            </div>
          </div>
        </div>

        <div class="lang" role="group" aria-label="Language switcher">
          <button id="btnUA" type="button" aria-pressed="true" title="–£–∫—Ä–∞—ó–Ω—Å—å–∫–∞">
            <img class="flag" alt="UA" src="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='18' height='12' viewBox='0 0 18 12'><rect width='18' height='6' y='0' fill='%23005BBB'/><rect width='18' height='6' y='6' fill='%23FFD500'/></svg>">
            UA
          </button>
          <button id="btnDE" type="button" aria-pressed="false" title="Deutsch">
            <img class="flag" alt="DE" src="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='18' height='12' viewBox='0 0 18 12'><rect width='18' height='4' y='0' fill='%23000'/><rect width='18' height='4' y='4' fill='%23D00'/><rect width='18' height='4' y='8' fill='%23FFCE00'/></svg>">
            DE
          </button>
        </div>
      </div>
    </header>

    <div class="chips">
      <div class="chip"><span class="dot" aria-hidden="true"></span><span id="t_live"><strong>–û–Ω–ª–∞–π–Ω</strong> ¬∑ –æ–Ω–æ–≤–ª—é—î—Ç—å—Å—è –≤—Ä—É—á–Ω—É</span></div>
      <div class="chip" id="lastUpdateChip">–û—Å—Ç–∞–Ω–Ω—î –æ–Ω–æ–≤–ª–µ–Ω–Ω—è: <strong>‚Äî</strong></div>
    </div>

    <main>
      <section class="card" aria-label="Listenvergleich">
        <h2 id="t_lists">–°–ø–∏—Å–∫–∏</h2>
        <div class="sub" id="t_lists_sub">–ú—ñ—Å—Ç–æ —Ç–∞ —Ä–∞–π–æ–Ω ‚Äî –Ω–µ–≤–µ–ª–∏–∫–µ –∑–º–∞–≥–∞–Ω–Ω—è –¥–æ —Ñ—ñ–Ω—ñ—à—É.</div>

        <div class="list" id="campaignList"></div>

        <div class="leader" id="leaderBox">‚Äî</div>
      </section>
    </main>

    <footer class="content-footer">
      ¬© <span id="year"></span> Rozbitski
    </footer>
  </div>

  <div class="toast" id="toast" role="status" aria-live="polite">
    <h3 id="toastTitle">‚Äî</h3>
    <p id="toastText">‚Äî</p>
  </div>

<script>
  const I18N = {
    uk: {
      title: "–ó–±—ñ—Ä –ø—ñ–¥–ø–∏—Å—ñ–≤",
      desc: "–ú–∏ –∑–±–∏—Ä–∞—î–º–æ –ø—ñ–¥—Ç—Ä–∏–º—É–≤–∞–ª—å–Ω—ñ –ø—ñ–¥–ø–∏—Å–∏, —â–æ–± –±–∞–ª–æ—Ç—É–≤–∞—Ç–∏—Å—è –Ω–∞ –≤–∏–±–æ—Ä–∞—Ö –†–∞–¥–∏ —ñ–Ω–æ–∑–µ–º—Ü—ñ–≤ 2026 —Ä–æ–∫—É –≤ –ì—ñ—Å—Å–µ–Ω—ñ.",
      live: "<strong>–û–Ω–ª–∞–π–Ω</strong> ¬∑ –æ–Ω–æ–≤–ª—é—î—Ç—å—Å—è –≤—Ä—É—á–Ω—É",
      lastUpdate: "–û—Å—Ç–∞–Ω–Ω—î –æ–Ω–æ–≤–ª–µ–Ω–Ω—è:",
      lists: "–°–ø–∏—Å–∫–∏",
      listsSub: "–ú—ñ—Å—Ç–æ —Ç–∞ —Ä–∞–π–æ–Ω ‚Äî –Ω–µ–≤–µ–ª–∏–∫–µ –∑–º–∞–≥–∞–Ω–Ω—è –¥–æ —Ñ—ñ–Ω—ñ—à—É.",
      minGoal: "–ú—ñ–Ω—ñ–º—É–º",
      maxGoal: "–ë–∞–∂–∞–Ω–æ –¥–æ—Å—è–≥—Ç–∏",
      collected: "–ó—ñ–±—Ä–∞–Ω–æ",
      delta: "–ó–º—ñ–Ω–∏–ª–æ—Å—å",
      remainingToMax: "–î–æ –±–∞–∂–∞–Ω–æ–≥–æ",
      remainingToMin: "–î–æ –º—ñ–Ω—ñ–º—É–º—É",
      leaderTitle: "–•—Ç–æ –ø–æ–ø–µ—Ä–µ–¥—É –∑–∞—Ä–∞–∑?",
      leaderTie: "–ù—ñ—á–∏—è ‚Äî –æ–±–∏–¥–≤–∞ —Å–ø–∏—Å–∫–∏ –Ω–∞ –æ–¥–Ω–∞–∫–æ–≤–æ–º—É —Ä—ñ–≤–Ω—ñ.",
      leaderText: (nameA, pctA, nameB, pctB) => `${nameA} –ø–æ–ø–µ—Ä–µ–¥—É: <b>${pctA}%</b> ( ${nameB}: ${pctB}% ).`,
      reachedMaxTitle: "–§—ñ–Ω—ñ—à! üéâ",
      reachedMaxText: (name) => `${name} –¥–æ—Å—è–≥ –º–∞–∫—Å–∏–º—É–º—É. –î—è–∫—É—î–º–æ!`,
      bothReachedTitle: "–û–±–∏–¥–≤–∞ —Ñ—ñ–Ω—ñ—à—É–≤–∞–ª–∏! üöÄ",
      bothReachedText: "–ú—ñ—Å—Ç–æ —Ç–∞ —Ä–∞–π–æ–Ω –¥–æ—Å—è–≥–ª–∏ –º–∞–∫—Å–∏–º—É–º—É. –°—É–ø–µ—Ä!",
    },
    de: {
      title: "Unterschriftensammlung",
      desc: "Wir sammeln Unterst√ºtzungsunterschriften, um zur Ausl√§nderbeiratswahl 2026 in Gie√üen anzutreten.",
      live: "<strong>Live</strong> ¬∑ manuell aktualisiert",
      lastUpdate: "Letztes Update:",
      lists: "Listen",
      listsSub: "Stadt und Landkreis ‚Äì kleiner Wettkampf bis zur Ziellinie.",
      minGoal: "Minimum",
      maxGoal: "Maximum",
      collected: "Gesammelt",
      delta: "√Ñnderung",
      remainingToMax: "Bis Maximum",
      remainingToMin: "Bis Minimum",
      leaderTitle: "Wer f√ºhrt gerade?",
      leaderTie: "Gleichstand ‚Äì beide Listen sind gleich weit.",
      leaderText: (nameA, pctA, nameB, pctB) => `${nameA} f√ºhrt: <b>${pctA}%</b> ( ${nameB}: ${pctB}% ).`,
      reachedMaxTitle: "Ziellinie! üéâ",
      reachedMaxText: (name) => `${name} hat das Maximum erreicht. Danke!`,
      bothReachedTitle: "Beide Ziele erreicht! üöÄ",
      bothReachedText: "Stadt und Landkreis haben das Maximum erreicht. Stark!",
    }
  };

  const state = {
    lang: "uk",
    data: null,
    celebratedKey: null,
    fxRunning: false,
    fxStopAt: 0
  };

  const el = (id) => document.getElementById(id);
  const els = {
    btnUA: el("btnUA"),
    btnDE: el("btnDE"),
    t_title: el("t_title"),
    t_desc: el("t_desc"),
    t_live: el("t_live"),
    lastUpdateChip: el("lastUpdateChip"),
    t_lists: el("t_lists"),
    t_lists_sub: el("t_lists_sub"),
    campaignList: el("campaignList"),
    leaderBox: el("leaderBox"),
    toast: el("toast"),
    toastTitle: el("toastTitle"),
    toastText: el("toastText"),
    fxWrap: el("fxWrap"),
    fx: el("fx"),
  };

  function setLang(lang){
    state.lang = lang;
    document.documentElement.lang = lang === "uk" ? "uk" : "de";

    els.btnUA.setAttribute("aria-pressed", lang === "uk" ? "true" : "false");
    els.btnDE.setAttribute("aria-pressed", lang === "de" ? "true" : "false");

    const t = I18N[lang];
    els.t_title.textContent = t.title;
    els.t_desc.textContent = t.desc;
    els.t_live.innerHTML = t.live;
    els.t_lists.textContent = t.lists;
    els.t_lists_sub.textContent = t.listsSub;

    render();
  }

  els.btnUA.addEventListener("click", () => setLang("uk"));
  els.btnDE.addEventListener("click", () => setLang("de"));

  const clamp = (v,min,max) => Math.min(max, Math.max(min,v));
  const fmtPct = (p) => (Math.round(p*10)/10).toFixed(1);

  function fmtDate(iso){
    if(!iso) return "‚Äî";
    const d = new Date(iso);
    if(Number.isNaN(d.getTime())) return "‚Äî";
    const locale = state.lang === "uk" ? "uk-UA" : "de-DE";
    return new Intl.DateTimeFormat(locale, {
      year:"numeric", month:"2-digit", day:"2-digit", hour:"2-digit", minute:"2-digit"
    }).format(d);
  }

  function nameForLang(c){
    return state.lang === "uk" ? (c.name_uk || c.name_de || c.id) : (c.name_de || c.name_uk || c.id);
  }

  function colorForPct(p){
    if(p < 40) return getCss("--c-low");
    if(p < 75) return getCss("--c-mid");
    return getCss("--c-high");
  }
  function getCss(varName){
    return getComputedStyle(document.documentElement).getPropertyValue(varName).trim();
  }

  // ‚ö° Energie-Emoji bei positivem Delta
  function formatDelta(n){
    const v = Number(n ?? 0);
    if(!Number.isFinite(v) || v === 0) return "¬±0";
    if(v > 0) return "+" + v + " ‚ö°";
    return String(v);
  }
  function deltaClass(n){
    const v = Number(n ?? 0);
    if(!Number.isFinite(v) || v === 0) return "";
    return v > 0 ? "deltaPlus" : "deltaMinus";
  }

  function compute(){
    const campaigns = (state.data?.campaigns || []).map(c => {
      const minGoal = Number(c.minGoal ?? 0);
      const maxGoal = Number(c.maxGoal ?? 0);
      const collected = Number(c.collected ?? 0);
      const delta = Number(c.delta ?? 0);

      const pctMax = maxGoal > 0 ? clamp((collected / maxGoal) * 100, 0, 120) : 0;
      const minPos = maxGoal > 0 ? clamp((minGoal / maxGoal) * 100, 0, 100) : 0;

      const remainingToMax = Math.max(maxGoal - collected, 0);
      const remainingToMin = Math.max(minGoal - collected, 0);

      const reachedMax = maxGoal > 0 && collected >= maxGoal;

      return {
        ...c,
        minGoal, maxGoal, collected, delta,
        pctMax, minPos,
        remainingToMax,
        remainingToMin,
        reachedMax
      };
    });

    const allReached = campaigns.length > 0 && campaigns.every(c => c.reachedMax);
    return { campaigns, allReached };
  }

  // ‚úÖ –∞–Ω–∏–º–∞—Ü–∏—è: –ø–æ—Å–ª–µ —Ä–µ–Ω–¥–µ—Ä–∞ –≤—ã—Å—Ç–∞–≤–ª—è–µ–º —à–∏—Ä–∏–Ω—É fill –∏–∑ data-target
  function animateFills(){
    const fills = els.campaignList.querySelectorAll(".fill[data-target]");
    requestAnimationFrame(() => {
      fills.forEach(f => {
        const target = Number(f.dataset.target || "0");
        const color = f.dataset.color || "";
        if(color) f.style.background = color;
        f.style.width = target + "%";
      });
    });
  }

  function render(){
    if(!state.data) return;
    const t = I18N[state.lang];

    els.lastUpdateChip.innerHTML = `${t.lastUpdate} <strong>${fmtDate(state.data.lastUpdated)}</strong>`;

    const s = compute();
    els.campaignList.innerHTML = "";

    s.campaigns.forEach(c => {
      const name = nameForLang(c);
      const pctLabel = fmtPct(clamp(c.pctMax,0,100));
      const targetWidth = clamp(c.pctMax,0,100);
      const fillColor = colorForPct(targetWidth);

      const item = document.createElement("div");
      item.className = "item";

      item.innerHTML = `
        <div class="itemHead">
          <div class="name">${name}</div>
          <div class="pct">${pctLabel}%</div>
        </div>

        <div class="progressWrap">
          <div class="track" aria-hidden="true">
            <!-- —Å—Ç–∞—Ä—Ç —Å 0%, –ø–æ—Ç–æ–º –∞–Ω–∏–º–∏—Ä—É–µ–º –∫ data-target -->
            <div class="fill" style="width:0%" data-target="${targetWidth}" data-color="${fillColor}"></div>
          </div>

          <!-- ‚úÖ marker –ø–æ–¥ bar -->
          <div class="minMarker" style="left:${c.minPos}%;" title="${t.minGoal}: ${c.minGoal}"></div>
        </div>

        <div class="badgeRow">
          <div class="pill">${t.collected}: <b>${c.collected}</b></div>
          <div class="pill ${deltaClass(c.delta)}">${t.delta}: <b>${formatDelta(c.delta)}</b></div>
          <div class="pill">${t.minGoal}: <b>${c.minGoal}</b></div>
          <div class="pill">${t.maxGoal}: <b>${c.maxGoal}</b></div>
        </div>

        <div class="row">
          <div>${t.remainingToMin}: <strong>${c.remainingToMin}</strong></div>
          <div>${t.remainingToMax}: <strong>${c.remainingToMax}</strong></div>
        </div>
      `;

      els.campaignList.appendChild(item);
    });

    // leader
    if(s.campaigns.length >= 2){
      const sorted = [...s.campaigns].sort((a,b)=> b.pctMax - a.pctMax);
      const a = sorted[0], b = sorted[1];
      const leaderTitle = `<b>${t.leaderTitle}</b><br/>`;
      if(Math.abs(a.pctMax - b.pctMax) < 0.05){
        els.leaderBox.innerHTML = leaderTitle + t.leaderTie;
      } else {
        els.leaderBox.innerHTML = leaderTitle + t.leaderText(
          nameForLang(a), fmtPct(clamp(a.pctMax,0,100)),
          nameForLang(b), fmtPct(clamp(b.pctMax,0,100))
        );
      }
    } else {
      els.leaderBox.innerHTML = `<b>${t.leaderTitle}</b><br/>‚Äî`;
    }

    maybeCelebrate(s);

    // ‚úÖ –∑–∞–ø—É—Å–∫–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è
    animateFills();
  }

  function showToast(title, text){
    els.toastTitle.textContent = title;
    els.toastText.textContent = text;
    els.toast.classList.add("show");
    clearTimeout(showToast._t);
    showToast._t = setTimeout(()=> els.toast.classList.remove("show"), 5200);
  }

  function maybeCelebrate(s){
    const t = I18N[state.lang];
    const key = state.data?.lastUpdated || "x";
    if(state.celebratedKey === key) return;

    const reached = s.campaigns.filter(c => c.reachedMax);
    if(reached.length === 0) return;

    state.celebratedKey = key;

    if(s.allReached){
      showToast(t.bothReachedTitle, t.bothReachedText);
      startFx(10000);
    } else {
      const first = reached[0];
      showToast(t.reachedMaxTitle, t.reachedMaxText(nameForLang(first)));
      startFx(7000);
    }
  }

  // Starfall FX (unver√§ndert)
  let ctx, W, H, stars = [];
  function resizeFx(){
    const dpr = Math.max(1, Math.min(2, window.devicePixelRatio || 1));
    W = window.innerWidth;
    H = window.innerHeight;
    els.fx.width = Math.floor(W * dpr);
    els.fx.height = Math.floor(H * dpr);
    els.fx.style.width = W + "px";
    els.fx.style.height = H + "px";
    ctx = els.fx.getContext("2d");
    ctx.setTransform(dpr,0,0,dpr,0,0);
  }
  function rand(a,b){ return a + Math.random()*(b-a); }
  function makeStar(){
    const big = Math.random() < 0.14;
    const r = big ? rand(3.2, 6.4) : rand(1.4, 3.2);
    const palette = [
      `rgba(34,197,94,`,
      `rgba(245,158,11,`,
      `rgba(239,68,68,`,
      `rgba(255,255,255,`
    ];
    const c = palette[Math.floor(Math.random()*palette.length)];
    return {
      x: rand(0, W),
      y: rand(-H, -20),
      vy: rand(1.3, 4.6) * (big ? 1.15 : 1),
      vx: rand(-0.35, 0.35),
      r,
      rot: rand(0, Math.PI*2),
      vr: rand(-0.07, 0.07),
      a: rand(0.35, 1),
      c
    };
  }
  function spawnStars(n){
    stars = [];
    for(let i=0;i<n;i++) stars.push(makeStar());
  }
  function drawStar(x,y,r,rot,alpha,colorPrefix){
    ctx.save();
    ctx.translate(x,y);
    ctx.rotate(rot);
    ctx.globalAlpha = alpha;
    ctx.beginPath();
    const spikes = 5;
    const outer = r;
    const inner = r*0.45;
    for(let i=0;i<spikes*2;i++){
      const ang = (Math.PI/spikes) * i;
      const rad = (i%2===0) ? outer : inner;
      ctx.lineTo(Math.cos(ang)*rad, Math.sin(ang)*rad);
    }
    ctx.closePath();
    ctx.fillStyle = colorPrefix + alpha + ")";
    ctx.fill();
    ctx.restore();
  }
  function tickFx(now){
    if(!state.fxRunning) return;
    if(now > state.fxStopAt){ stopFx(); return; }
    ctx.clearRect(0,0,W,H);

    for(const s of stars){
      s.x += s.vx;
      s.y += s.vy;
      s.rot += s.vr;
      s.a += rand(-0.03, 0.03);
      s.a = clamp(s.a, 0.2, 1);

      drawStar(s.x, s.y, s.r, s.rot, s.a, s.c);

      if(s.y > H + 30){
        s.x = rand(0, W);
        s.y = rand(-220, -20);
        s.vy = rand(1.3, 4.6);
      }
    }
    requestAnimationFrame(tickFx);
  }
  function startFx(durationMs){
    if(state.fxRunning){
      state.fxStopAt = performance.now() + durationMs;
      return;
    }
    state.fxRunning = true;
    state.fxStopAt = performance.now() + durationMs;
    els.fxWrap.classList.add("show");
    resizeFx();
    const n = Math.min(200, Math.max(90, Math.floor((W*H)/16000)));
    spawnStars(n);
    requestAnimationFrame(tickFx);
  }
  function stopFx(){
    state.fxRunning = false;
    els.fxWrap.classList.remove("show");
    if(ctx) ctx.clearRect(0,0,W,H);
  }
  window.addEventListener("resize", ()=>{ if(state.fxRunning) resizeFx(); });

  async function loadData(){
    const res = await fetch("signatures.json?ts=" + Date.now(), { cache: "no-store" });
    if(!res.ok) throw new Error("signatures.json konnte nicht geladen werden");
    return await res.json();
  }

  (async function init(){
    setLang("uk");
    try{
      state.data = await loadData();
      render();
    }catch(e){
      console.error(e);
      showToast("‚ö†Ô∏è", "signatures.json konnte nicht geladen werden. Bitte lokal √ºber http testen (Live Server / python -m http.server).");
    }
  })();

  document.getElementById("year").textContent = new Date().getFullYear();
</script>
</body>
</html>
